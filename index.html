<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Interval Trainer (12-TET)</title>
    <style>
      :root {
        --bg: #0b0f17;
        --text: #e8eefc;
        --muted: #9fb0d0;
        --shadow: 0 12px 30px rgba(0, 0, 0, 0.35);
        --radius: 18px;
      }

      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial,
          sans-serif;
        background: radial-gradient(
            1200px 600px at 20% 0%,
            rgba(84, 132, 255, 0.18),
            transparent 55%
          ),
          radial-gradient(
            900px 500px at 80% 10%,
            rgba(255, 99, 132, 0.14),
            transparent 60%
          ),
          var(--bg);
        color: var(--text);
        min-height: 100vh;
        display: grid;
        place-items: center;
        padding: 24px;
      }

      .wrap {
        width: min(900px, 100%);
      }

      header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 12px;
        margin-bottom: 14px;
        flex-wrap: wrap;
      }

      .title {
        font-weight: 800;
        letter-spacing: 0.2px;
        font-size: 18px;
        opacity: 0.95;
      }

      .rowRight {
        display: inline-flex;
        gap: 10px;
        align-items: center;
        flex-wrap: wrap;
        justify-content: flex-end;
      }

      .pill,
      .select,
      .smallBtn {
        border: 1px solid rgba(255, 255, 255, 0.12);
        background: rgba(255, 255, 255, 0.06);
        color: var(--text);
        border-radius: 999px;
        padding: 8px 12px;
        font-weight: 800;
        font-size: 13px;
        cursor: pointer;
        outline: none;
      }
      .select option {
        background: #0b0f17;
      }

      .pill {
        cursor: default;
        display: inline-flex;
        gap: 10px;
        align-items: center;
      }
      .pill small {
        color: var(--muted);
        font-weight: 700;
        letter-spacing: 0.2px;
      }

      .card {
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.04),
          rgba(255, 255, 255, 0.02)
        );
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        overflow: hidden;
      }

      .cardTop {
        padding: 18px 18px 10px 18px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 12px;
        flex-wrap: wrap;
      }

      .badge {
        font-weight: 900;
        text-transform: uppercase;
        letter-spacing: 0.12em;
        font-size: 12px;
        padding: 8px 10px;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.14);
        background: rgba(255, 255, 255, 0.06);
      }

      .hint {
        color: var(--muted);
        font-size: 13px;
        line-height: 1.3;
        text-align: right;
        flex: 1;
        min-width: 220px;
      }

      .noteBox {
        padding: 26px 18px 16px 18px;
        display: grid;
        place-items: center;
        gap: 10px;
      }

      .note {
        font-size: 84px;
        font-weight: 950;
        letter-spacing: -2px;
        line-height: 1;
        padding: 10px 18px;
        border-radius: 16px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        background: rgba(0, 0, 0, 0.14);
        min-width: 160px;
        text-align: center;
      }

      .sub {
        color: var(--muted);
        font-size: 14px;
        text-align: center;
      }

      .answers {
        padding: 16px 18px 20px 18px;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }

      button.answer {
        appearance: none;
        border: 1px solid rgba(255, 255, 255, 0.12);
        background: rgba(255, 255, 255, 0.06);
        color: var(--text);
        border-radius: 14px;
        padding: 14px 14px;
        font-weight: 900;
        font-size: 20px;
        cursor: pointer;
        transition: transform 0.06s ease, background 0.12s ease,
          border-color 0.12s ease;
        user-select: none;
      }
      button.answer:hover {
        background: rgba(255, 255, 255, 0.09);
        border-color: rgba(255, 255, 255, 0.18);
      }
      button.answer:active {
        transform: translateY(1px);
      }

      button.answer.bad {
        background: rgba(163, 38, 42, 0.28);
        border-color: rgba(163, 38, 42, 0.6);
        color: #ffd9db;
      }
      button.answer.good {
        background: rgba(31, 122, 58, 0.28);
        border-color: rgba(31, 122, 58, 0.6);
        color: #d7ffe4;
      }

      .footer {
        padding: 0 18px 18px 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 12px;
        flex-wrap: wrap;
      }

      .msg {
        min-height: 20px;
        font-weight: 800;
        letter-spacing: 0.1px;
      }
      .msg.bad {
        color: #ffb7bb;
      }
      .msg.good {
        color: #b8ffd0;
      }

      .controls {
        display: inline-flex;
        gap: 10px;
        align-items: center;
        flex-wrap: wrap;
        justify-content: flex-end;
      }

      @media (max-width: 560px) {
        .answers {
          grid-template-columns: 1fr;
        }
        .note {
          font-size: 72px;
          min-width: 140px;
        }
        .hint {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <header>
        <div class="title">Interval flashcard quiz (notes)</div>
        <div class="rowRight">
          <select
            class="select"
            id="modeSelect"
            title="Which intervals to practice?"
          ></select>
          <select
            class="select"
            id="spellingSelect"
            title="Prefer sharps or flats?"
          ></select>
          <div class="pill"><small>Score</small> <span id="score">0</span></div>
        </div>
      </header>

      <div class="card">
        <div class="cardTop">
          <div class="badge" id="intervalLabel">PERFECT 5TH</div>
          <div class="hint">
            From the shown note, pick the target note that is the selected
            interval <b>above</b>.
          </div>
        </div>

        <div class="noteBox">
          <div class="note" id="rootNote">C</div>
          <div class="sub" id="questionText">
            What is the perfect 5th above C?
          </div>
        </div>

        <div class="answers" id="answers"></div>

        <div class="footer">
          <div class="msg" id="msg"></div>
          <div class="controls">
            <button class="smallBtn" id="skipBtn" title="Skip without scoring">
              Skip
            </button>
            <button class="smallBtn" id="resetBtn" title="Reset score">
              Reset
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Pitch classes as two spellings (enharmonic).
      // Internally we work with pitch-class indices 0..11, and render using the chosen spelling.
      const NOTES_SHARPS = [
        "C",
        "C#",
        "D",
        "D#",
        "E",
        "F",
        "F#",
        "G",
        "G#",
        "A",
        "A#",
        "B",
      ];
      const NOTES_FLATS = [
        "C",
        "Db",
        "D",
        "Eb",
        "E",
        "F",
        "Gb",
        "G",
        "Ab",
        "A",
        "Bb",
        "B",
      ];

      // Interval list (semitones in 12-TET).
      // Tritone is enharmonic A4/D5; label shows both.
      const ALL_INTERVALS = [
        { id: "m2", label: "MINOR 2ND", name: "minor 2nd", semitones: 1 },
        { id: "M2", label: "MAJOR 2ND", name: "major 2nd", semitones: 2 },
        { id: "m3", label: "MINOR 3RD", name: "minor 3rd", semitones: 3 },
        { id: "M3", label: "MAJOR 3RD", name: "major 3rd", semitones: 4 },
        { id: "P4", label: "PERFECT 4TH", name: "perfect 4th", semitones: 5 },
        { id: "TT", label: "TRITONE (A4/D5)", name: "tritone", semitones: 6 },
        { id: "P5", label: "PERFECT 5TH", name: "perfect 5th", semitones: 7 },
        { id: "m6", label: "MINOR 6TH", name: "minor 6th", semitones: 8 },
        { id: "M6", label: "MAJOR 6TH", name: "major 6th", semitones: 9 },
        { id: "m7", label: "MINOR 7TH", name: "minor 7th", semitones: 10 },
        { id: "M7", label: "MAJOR 7TH", name: "major 7th", semitones: 11 },
        { id: "P8", label: "OCTAVE (P8)", name: "octave", semitones: 12 },
      ];

      // Practice modes (dropdown).
      const MODES = [
        {
          id: "p4p5",
          label: "P4 + P5",
          intervalIds: ["P4", "P5"],
        },
        {
          id: "majorScale",
          label: "Major scale (degrees above root)",
          intervalIds: ["M2", "M3", "P4", "P5", "M6", "M7", "P8"],
        },
        {
          id: "naturalMinor",
          label: "Natural minor scale (degrees above root)",
          // Correct: M2, m3, P4, P5, m6, m7, P8
          intervalIds: ["M2", "m3", "P4", "P5", "m6", "m7", "P8"],
        },
        {
          id: "harmonicMinor",
          label: "Harmonic minor scale (degrees above root)",
          // Natural minor but raised 7th: M7 instead of m7
          intervalIds: ["M2", "m3", "P4", "P5", "m6", "M7", "P8"],
        },
        {
          id: "all",
          label: "All intervals (m2 â†’ P8)",
          intervalIds: ALL_INTERVALS.map((i) => i.id),
        },
      ];

      const SPELLINGS = [
        { id: "auto", label: "Auto (mix)", type: "auto" },
        { id: "sharp", label: "Prefer sharps (#)", type: "sharp" },
        { id: "flat", label: "Prefer flats (b)", type: "flat" },
      ];

      // State
      let score = 0;
      let locked = false;
      let current = null; // { rootIndex, interval, correctIndex, spellingType }
      let activeIntervalIds = MODES[0].intervalIds;
      let spellingType = "auto"; // auto | sharp | flat

      // DOM
      const scoreEl = document.getElementById("score");
      const intervalLabelEl = document.getElementById("intervalLabel");
      const rootNoteEl = document.getElementById("rootNote");
      const questionTextEl = document.getElementById("questionText");
      const answersEl = document.getElementById("answers");
      const msgEl = document.getElementById("msg");
      const skipBtn = document.getElementById("skipBtn");
      const resetBtn = document.getElementById("resetBtn");
      const modeSelect = document.getElementById("modeSelect");
      const spellingSelect = document.getElementById("spellingSelect");

      function randInt(n) {
        return Math.floor(Math.random() * n);
      }

      function shuffle(arr) {
        for (let i = arr.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
      }

      function setMessage(text, kind = "") {
        msgEl.textContent = text;
        msgEl.className = "msg" + (kind ? " " + kind : "");
      }

      function getIntervalById(id) {
        return ALL_INTERVALS.find((i) => i.id === id);
      }

      function pickRandomInterval() {
        const id = activeIntervalIds[randInt(activeIntervalIds.length)];
        return getIntervalById(id);
      }

      function pickSpellingForQuestion() {
        if (spellingType === "sharp" || spellingType === "flat")
          return spellingType;
        return Math.random() < 0.5 ? "sharp" : "flat"; // auto: mix per question
      }

      function noteName(pcIndex, spellingMode) {
        if (spellingMode === "sharp") return NOTES_SHARPS[pcIndex];
        if (spellingMode === "flat") return NOTES_FLATS[pcIndex];

        // auto = random per note
        return Math.random() < 0.5
          ? NOTES_SHARPS[pcIndex]
          : NOTES_FLATS[pcIndex];
      }

      function nextQuestion() {
        locked = false;
        setMessage("");

        const rootIndex = randInt(12);
        const interval = pickRandomInterval();
        const semis = interval.semitones % 12; // octave wraps to 0
        const correctIndex = (rootIndex + semis) % 12;

        const qSpelling = pickSpellingForQuestion();

        current = { rootIndex, interval, correctIndex };

        const rootText = noteName(rootIndex, spellingType);
        
        intervalLabelEl.textContent = interval.label;

        rootNoteEl.textContent = rootText;

        questionTextEl.textContent = `What is the ${interval.name} above ${rootText}?`;

        // Build choices: 1 correct + 3 incorrect pitch classes (distinct).
        const choices = new Set([correctIndex]);
        while (choices.size < 4) {
          const idx = randInt(12);
          if (idx !== correctIndex) choices.add(idx);
        }
        const choiceIndices = shuffle([...choices]);

        // Render buttons with same spelling as the question
        answersEl.innerHTML = "";
        for (const idx of choiceIndices) {
          const btn = document.createElement("button");
          btn.className = "answer";
          btn.type = "button";
          btn.textContent = noteName(idx, spellingType);
          btn.dataset.noteIndex = String(idx);
          btn.addEventListener("click", onAnswerClick);
          answersEl.appendChild(btn);
        }
      }

      function onAnswerClick(e) {
        if (!current || locked) return;

        const btn = e.currentTarget;
        const chosenIndex = Number(btn.dataset.noteIndex);

        if (chosenIndex === current.correctIndex) {
          locked = true;
          btn.classList.remove("bad");
          btn.classList.add("good");

          score += 1;
          scoreEl.textContent = String(score);

          setMessage("Correct!", "good");
          setTimeout(nextQuestion, 650);
        } else {
          btn.classList.add("bad");
          setMessage("Try again.", "bad");
        }
      }

      function populateSelect(selectEl, items, defaultId) {
        selectEl.innerHTML = "";
        for (const it of items) {
          const opt = document.createElement("option");
          opt.value = it.id;
          opt.textContent = it.label;
          selectEl.appendChild(opt);
        }
        selectEl.value = defaultId;
      }

      modeSelect.addEventListener("change", () => {
        const mode = MODES.find((m) => m.id === modeSelect.value) || MODES[0];
        activeIntervalIds = mode.intervalIds;
        nextQuestion();
      });

      spellingSelect.addEventListener("change", () => {
        const sp =
          SPELLINGS.find((s) => s.id === spellingSelect.value) || SPELLINGS[0];
        spellingType = sp.type;
        nextQuestion();
      });

      skipBtn.addEventListener("click", () => nextQuestion());

      resetBtn.addEventListener("click", () => {
        score = 0;
        scoreEl.textContent = "0";
        nextQuestion();
      });

      // Init
      populateSelect(modeSelect, MODES, MODES[0].id);
      populateSelect(spellingSelect, SPELLINGS, SPELLINGS[0].id);
      nextQuestion();
    </script>
  </body>
</html>
